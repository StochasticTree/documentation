<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>StochTree: stochtree C++ Documentation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">StochTree<span id="projectnumber">&#160;0.1.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">stochtree C++ Documentation </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="getting-started"></a>
Getting Started</h1>
<p><code>stochtree</code> can be built and run as a standalone C++ program directly from source using <code>cmake</code>:</p>
<h2><a class="anchor" id="cloning-repo"></a>
Cloning the Repository</h2>
<p>To clone the repository, you must have git installed, which you can do following <a href="https://learn.microsoft.com/en-us/devops/develop/git/install-and-set-up-git">these instructions</a>.</p>
<p>Once git is available at the command line, navigate to the folder that will store this project (in bash / zsh, this is done by running <code>cd</code> followed by the path to the directory). Then, clone the <code>stochtree</code> repo as a subfolder by running </p><div class="fragment"><div class="line">git clone --recursive https://github.com/StochasticTree/stochtree.git</div>
</div><!-- fragment --><p><b>NOTE</b>: this project incorporates several dependencies as <a href="https://git-scm.com/book/en/v2/Git-Tools-Submodules">git submodules</a>, which is why the <code>--recursive</code> flag is necessary (some systems may perform a recursive clone without this flag, but <code>--recursive</code> ensures this behavior on all platforms). If you have already cloned the repo without the <code>--recursive</code> flag, you can retrieve the submodules recursively by running <code>git submodule update --init --recursive</code> in the main repo directory.</p>
<h1><a class="anchor" id="key-components"></a>
Key Components</h1>
<p>The stochtree C++ core consists of thousands of lines of C++ code, but it can organized and understood through several components (see <a href="topics.html">topics</a> for more detail):</p>
<ul>
<li><b>Trees</b>: the most important "primitive" of decision tree algorithms is the <a class="el" href="group__tree__group.html">decision tree itself</a>, which in stochtree is defined by a <a class="el" href="classStochTree_1_1Tree.html">Tree</a> class as well as a series of static helper functions for prediction.</li>
<li><b>Forest</b>: individual trees are combined into a <a class="el" href="group__forest__group.html">forest</a>, or ensemble, which in stochtree is defined by the <a class="el" href="classStochTree_1_1TreeEnsemble.html">TreeEnsemble</a> class and a container of forests is defined by the <a class="el" href="classStochTree_1_1ForestContainer.html">ForestContainer</a> class.</li>
<li><b>Dataset</b>: data can be loaded from a variety of sources into a <code>stochtree</code> <a class="el" href="group__data__group.html">data layer</a>.</li>
<li><b>Leaf Model</b>: <code>stochtree</code>'s data structures are generalized to support a wide range of models, which are defined via specialized classes in the <a class="el" href="group__leaf__model__group.html">leaf model layer</a>.</li>
<li><b>Sampler</b>: helper functions that sample forests from training data comprise the <a class="el" href="group__sampling__group.html">sampling layer</a> of <code>stochtree</code>.</li>
</ul>
<h1><a class="anchor" id="extending-stochtree"></a>
Extending stochtree</h1>
<h2><a class="anchor" id="custom-leaf-models"></a>
Custom Leaf Models</h2>
<p>The <a class="el" href="group__leaf__model__group.html">leaf model documentation</a> details the key components of new decision tree models: custom <code>LeafModel</code> and <code>SuffStat</code> classes that implement a model's log marginal likelihood and posterior computations.</p>
<p>Adding a new leaf model will consist largely of implementing new versions of each of these classes which track the API of the existing classes. Once these classes exist, they need to be reflected in several places.</p>
<p>Suppose, for the sake of illustration, that the newest custom leaf model is a multinomial logit model.</p>
<p>First, add an entry to the <a class="el" href="group__leaf__model__group.html#ga8cbfe035085adfd1a05335cf6f543a07">ModelType</a> enumeration for this new model type</p>
<div class="fragment"><div class="line"><span class="keyword">enum</span> ModelType {</div>
<div class="line">   kConstantLeafGaussian, </div>
<div class="line">   kUnivariateRegressionLeafGaussian, </div>
<div class="line">   kMultivariateRegressionLeafGaussian, </div>
<div class="line">   kLogLinearVariance, </div>
<div class="line">   kMultinomialLogit, </div>
<div class="line">};</div>
</div><!-- fragment --><p>Next, add entries to the <code>std::variants</code> that bundle related <code>SuffStat</code> and <code>LeafModel</code> classes</p>
<div class="fragment"><div class="line"><span class="keyword">using </span>SuffStatVariant = std::variant&lt;GaussianConstantSuffStat, </div>
<div class="line">                                     GaussianUnivariateRegressionSuffStat, </div>
<div class="line">                                     GaussianMultivariateRegressionSuffStat, </div>
<div class="line">                                     LogLinearVarianceSuffStat, </div>
<div class="line">                                     MultinomialLogitSuffStat&gt;;</div>
</div><!-- fragment --><div class="fragment"><div class="line"><span class="keyword">using </span>LeafModelVariant = std::variant&lt;GaussianConstantLeafModel, </div>
<div class="line">                                      GaussianUnivariateRegressionLeafModel, </div>
<div class="line">                                      GaussianMultivariateRegressionLeafModel, </div>
<div class="line">                                      LogLinearVarianceLeafModel, </div>
<div class="line">                                      MultinomialLogitLeafModel&gt;;</div>
</div><!-- fragment --><p>Finally, update the <a class="el" href="group__leaf__model__group.html#ga1f479f37cb7892d7d9a4fe2c9fca9ed3">suffStatFactory</a> and <a class="el" href="group__leaf__model__group.html#gaaba5f1e9af5724f79d1387fc97f7fc09">leafModelFactory</a> functions to add a logic branch registering these new objects</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> SuffStatVariant suffStatFactory(ModelType model_type, <span class="keywordtype">int</span> basis_dim = 0) {</div>
<div class="line">  <span class="keywordflow">if</span> (model_type == kConstantLeafGaussian) {</div>
<div class="line">    <span class="keywordflow">return</span> createSuffStat&lt;GaussianConstantSuffStat&gt;();</div>
<div class="line">  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (model_type == kUnivariateRegressionLeafGaussian) {</div>
<div class="line">    <span class="keywordflow">return</span> createSuffStat&lt;GaussianUnivariateRegressionSuffStat&gt;();</div>
<div class="line">  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (model_type == kMultivariateRegressionLeafGaussian) {</div>
<div class="line">    <span class="keywordflow">return</span> createSuffStat&lt;GaussianMultivariateRegressionSuffStat, int&gt;(basis_dim);</div>
<div class="line">  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (model_type == kLogLinearVariance) {</div>
<div class="line">    <span class="keywordflow">return</span> createSuffStat&lt;LogLinearVarianceSuffStat&gt;();</div>
<div class="line">  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (model_type == kMultinomialLogit) {</div>
<div class="line">    <span class="keywordflow">return</span> createSuffStat&lt;MultinomialLogitSuffStat&gt;();</div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    Log::Fatal(<span class="stringliteral">&quot;Incompatible model type provided to suff stat factory&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> LeafModelVariant leafModelFactory(ModelType model_type, <span class="keywordtype">double</span> tau, Eigen::MatrixXd&amp; Sigma0, <span class="keywordtype">double</span> a, <span class="keywordtype">double</span> b) {</div>
<div class="line">  <span class="keywordflow">if</span> (model_type == kConstantLeafGaussian) {</div>
<div class="line">    <span class="keywordflow">return</span> createLeafModel&lt;GaussianConstantLeafModel, double&gt;(tau);</div>
<div class="line">  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (model_type == kUnivariateRegressionLeafGaussian) {</div>
<div class="line">    <span class="keywordflow">return</span> createLeafModel&lt;GaussianUnivariateRegressionLeafModel, double&gt;(tau);</div>
<div class="line">  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (model_type == kMultivariateRegressionLeafGaussian) {</div>
<div class="line">    <span class="keywordflow">return</span> createLeafModel&lt;GaussianMultivariateRegressionLeafModel, Eigen::MatrixXd&gt;(Sigma0);</div>
<div class="line">  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (model_type == kLogLinearVariance) {</div>
<div class="line">    <span class="keywordflow">return</span> createLeafModel&lt;LogLinearVarianceLeafModel, double, double&gt;(a, b);</div>
<div class="line">  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (model_type == kMultinomialLogit) {</div>
<div class="line">    <span class="keywordflow">return</span> createLeafModel&lt;MultinomialLogitLeafModel&gt;();</div>
<div class="line">  } <span class="keywordflow">else</span> {</div>
<div class="line">    Log::Fatal(<span class="stringliteral">&quot;Incompatible model type provided to leaf model factory&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
